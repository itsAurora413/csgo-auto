{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{init,dispose}from'klinecharts';import axios from'axios';import{Card,Segmented,Spin}from'antd';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const GoodKlineChart=_ref=>{let{goodId,height=360}=_ref;const ref=useRef(null);const chartRef=useRef(null);const[loading,setLoading]=useState(false);const[interval,setInterval]=useState('20m');const[hasData,setHasData]=useState(false);useEffect(()=>{if(ref.current&&!chartRef.current){chartRef.current=init(ref.current);try{var _chartRef$current,_chartRef$current$set;(_chartRef$current=chartRef.current)===null||_chartRef$current===void 0?void 0:(_chartRef$current$set=_chartRef$current.setBarSpace)===null||_chartRef$current$set===void 0?void 0:_chartRef$current$set.call(_chartRef$current,8);}catch(_unused){}}return()=>{if(chartRef.current&&ref.current){dispose(ref.current);chartRef.current=null;}};},[]);useEffect(()=>{if(!chartRef.current||!goodId)return;let cancelled=false;(async()=>{setLoading(true);try{var _real$data;const real=await axios.get('/csqaq/good/kline',{params:{id:goodId,interval}});let rows=((_real$data=real.data)===null||_real$data===void 0?void 0:_real$data.data)||[];if(!rows.length){var _derived$data;const derived=await axios.get('/csqaq/good/derived_kline',{params:{id:goodId,days:30}});rows=((_derived$data=derived.data)===null||_derived$data===void 0?void 0:_derived$data.data)||[];}if(cancelled)return;const data=rows.map(p=>({timestamp:Number(p.t),open:p.o,high:p.h,low:p.l,close:p.c,volume:p.v}));chartRef.current.applyNewData(data);setHasData(!!data.length);}finally{if(!cancelled)setLoading(false);}})();return()=>{cancelled=true;};},[goodId,interval]);return/*#__PURE__*/_jsxs(Card,{title:\"\\u4EF7\\u683CK\\u7EBF\",extra:/*#__PURE__*/_jsx(Segmented,{options:[{label:'20分',value:'20m'},{label:'1小时',value:'1h'},{label:'1天',value:'1d'}],value:interval,onChange:v=>setInterval(v)}),children:[/*#__PURE__*/_jsx(\"div\",{ref:ref,style:{height}}),loading&&/*#__PURE__*/_jsx(Spin,{style:{position:'absolute',right:16,top:16}}),!hasData&&!loading&&/*#__PURE__*/_jsx(\"div\",{style:{padding:8,color:'#999'},children:\"\\u6682\\u65E0\\u6570\\u636E\\uFF0C\\u5DF2\\u56DE\\u9000\\u5230\\u63A8\\u5BFC\\u8D70\\u52BF\"})]});};export default GoodKlineChart;","map":{"version":3,"names":["React","useEffect","useRef","useState","init","dispose","axios","Card","Segmented","Spin","jsx","_jsx","jsxs","_jsxs","GoodKlineChart","_ref","goodId","height","ref","chartRef","loading","setLoading","interval","setInterval","hasData","setHasData","current","_chartRef$current","_chartRef$current$set","setBarSpace","call","_unused","cancelled","_real$data","real","get","params","id","rows","data","length","_derived$data","derived","days","map","p","timestamp","Number","t","open","o","high","h","low","l","close","c","volume","v","applyNewData","title","extra","options","label","value","onChange","children","style","position","right","top","padding","color"],"sources":["/Users/user/Downloads/csgoAuto/web/src/components/GoodKlineChart.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { init, dispose, Chart } from 'klinecharts';\nimport axios from 'axios';\nimport { Card, Segmented, Spin } from 'antd';\n\ninterface KPoint { t: number; o: number; h: number; l: number; c: number; v: number }\n\ninterface Props {\n  goodId: string | number;\n  height?: number;\n}\n\nconst GoodKlineChart: React.FC<Props> = ({ goodId, height = 360 }) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const chartRef = useRef<Chart | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [interval, setInterval] = useState<'20m' | '1h' | '1d'>('20m');\n  const [hasData, setHasData] = useState(false);\n\n  useEffect(() => {\n    if (ref.current && !chartRef.current) {\n      chartRef.current = init(ref.current);\n      try { chartRef.current?.setBarSpace?.(8 as any); } catch {}\n    }\n    return () => {\n      if (chartRef.current && ref.current) {\n        dispose(ref.current);\n        chartRef.current = null;\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!chartRef.current || !goodId) return;\n    let cancelled = false;\n    (async () => {\n      setLoading(true);\n      try {\n        const real = await axios.get('/csqaq/good/kline', { params: { id: goodId, interval } });\n        let rows: KPoint[] = real.data?.data || [];\n        if (!rows.length) {\n          const derived = await axios.get('/csqaq/good/derived_kline', { params: { id: goodId, days: 30 } });\n          rows = derived.data?.data || [];\n        }\n        if (cancelled) return;\n        const data = rows.map((p: any) => ({ timestamp: Number(p.t), open: p.o, high: p.h, low: p.l, close: p.c, volume: p.v }));\n        chartRef.current!.applyNewData(data);\n        setHasData(!!data.length);\n      } finally { if (!cancelled) setLoading(false); }\n    })();\n    return () => { cancelled = true; };\n  }, [goodId, interval]);\n\n  return (\n    <Card title=\"价格K线\" extra={<Segmented options={[{label:'20分', value:'20m'}, {label:'1小时', value:'1h'}, {label:'1天', value:'1d'}]} value={interval} onChange={(v)=> setInterval(v as any)} />}>\n      <div ref={ref} style={{ height }} />\n      {loading && <Spin style={{ position:'absolute', right: 16, top: 16 }} />}\n      {!hasData && !loading && <div style={{ padding: 8, color: '#999' }}>暂无数据，已回退到推导走势</div>}\n    </Card>\n  );\n};\n\nexport default GoodKlineChart;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}