# 套利分析器风险控制优化

## 修改时间
2025-10-13

## 修改目的
降低单件饰品求购数量,防止价格下跌时单一饰品造成过大损失。

## 主要修改

### 1. 调整基础购买数量
**位置**: `calculateOptimalQuantity` 函数

**修改前**:
- 低风险: 5件
- 中风险: 3件  
- 高风险: 2件

**修改后**:
- 低风险: 3件
- 中风险: 2件
- 高风险: 1件

### 2. 降低各类加仓幅度
**修改前**:
- 主战武器加仓: +2件
- 崭新磨损加仓: +2件
- 流动性好加仓: +3件
- 低价商品加仓: +3件
- 中价商品加仓: +2件
- 上涨趋势加仓: +2件

**修改后**:
- 主战武器加仓: +1件
- 崭新磨损加仓: +1件
- 流动性好加仓: +1件
- 低价商品加仓: +1件
- 上涨趋势加仓: +1件

### 3. 设置硬性上限
**关键修改**: 
```go
// === 9. 硬性上限：每件饰品最多5件（风险控制） ===
maxPositionLimit := 5
```

无论评分多高、利润率多好,每件饰品最多只购买5件。

**修改前的上限**:
- 默认上限: 10-20件
- 高利润率低风险: 20件
- 低价商品: 20件

**修改后的上限**:
- 所有商品统一: 最多5件

### 4. 移除第二轮预算分配
**修改前**: 如果预算使用率低于50%,会进行第二轮分配,对已购买商品追加数量

**修改后**: 完全移除第二轮分配逻辑,避免突破5件上限

### 5. 优化高价商品控制
**新增逻辑**:
```go
if buyPrice > 500 {
    // 高价商品：控制数量，降低风险
    baseQuantity = int(math.Min(float64(baseQuantity), 2)) // 高价商品最多2件
}
```

价格超过500元的商品,基础数量不超过2件。

## 风险控制效果

### 修改前可能出现的情况:
- 单件主战武器崭新饰品: 可能购买10-20件
- 低价商品: 可能购买15-20件
- 高利润率商品: 可能购买20件

### 修改后的保证:
- **所有饰品**: 最多5件
- **高价商品**(>500元): 最多2件
- **下跌趋势商品**: 进一步减少数量

## 预期收益影响
- 单次分析的总投入可能会降低
- 但风险显著下降,单一饰品下跌造成的损失有限
- 通过增加饰品种类(而非单品数量)来分散风险

## 使用方法
重新编译并运行套利分析器:
```bash
cd /Users/user/Downloads/csgoAuto
go build -o bin/arbitrage-analyzer-updated cmd/arbitrage-analyzer/main.go
./bin/arbitrage-analyzer-updated --budget=2000 --min-profit=0.05
```

## 建议
1. 可以适当提高总预算,通过增加饰品种类来提高收益
2. 建议每次分析后人工审核求购清单
3. 关注市场趋势,避免在整体下跌时大量求购
4. 定期运行回测模式验证策略效果

## 备注
- 原始文件已更新: `cmd/arbitrage-analyzer/main.go`
- 编译后的二进制: `bin/arbitrage-analyzer-updated`
- 如需恢复原始逻辑,请从git历史恢复

